@using Microsoft.AspNetCore.Components.Web

@if (IsVisible)
{
    <div class="context-menu" style="top: @(Y)px; left: @(X)px;">
        <ul class="list-group">
            @foreach (var item in Items)
            {
                <li class="list-group-item list-group-item-action @(item.Disabled ? "disabled" : "")" 
                    @onclick="() => OnItemClick(item)">
                    <i class="@item.Icon mr-2"></i> @item.Text
                </li>
            }
        </ul>
    </div>
    <div class="context-menu-overlay" @onclick="Hide"></div>
}

<style>
    .context-menu {
        position: fixed;
        z-index: 9999;
        background: white;
        border: 1px solid #ccc;
        box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
        min-width: 150px;
        border-radius: 4px;
    }
    .context-menu-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 9998;
        background: transparent;
    }
    .list-group-item {
        cursor: pointer;
        padding: 5px 15px;
        font-size: 0.9em;
    }
    .list-group-item:hover {
        background-color: #f8f9fa;
    }
</style>

@code {
    public bool IsVisible { get; private set; }
    public double X { get; private set; }
    public double Y { get; private set; }
    public List<ContextMenuItem> Items { get; private set; } = new();

    public void Show(double x, double y, List<ContextMenuItem> items)
    {
        X = x;
        Y = y;
        Items = items;
        IsVisible = true;
        StateHasChanged();
    }

    public void Hide()
    {
        IsVisible = false;
        StateHasChanged();
    }

    private async Task OnItemClick(ContextMenuItem item)
    {
        if (item.Disabled) return;
        Hide();
        if (item.ActionAsync != null)
        {
            await item.ActionAsync.Invoke();
        }
        else 
        {
            item.Action?.Invoke();
        }
    }

    public class ContextMenuItem
    {
        public string Text { get; set; } = string.Empty;
        public string Icon { get; set; } = string.Empty;
        public Action? Action { get; set; }
        public Func<Task>? ActionAsync { get; set; } // Add Async support
        public bool Disabled { get; set; }
    }
}
